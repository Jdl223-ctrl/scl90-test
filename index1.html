<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>SCL-90 心理健康自评 | 清风治愈屋</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
      background:#f5f7fb;
      margin:0;
      color:#333;
    }
    .container {
      max-width: 820px;
      margin: auto;
      padding: 16px;
    }
    h1,h2 { text-align:center; }
    .card {
      background:#fff;
      border-radius:14px;
      padding:20px;
      margin-bottom:16px;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
    }
    .question { margin-bottom:18px; }
    .options label {
      display:inline-block;
      margin-right:10px;
      margin-top:6px;
      cursor:pointer;
    }
    button {
      background:#6366f1;
      color:#fff;
      border:none;
      padding:12px 18px;
      border-radius:10px;
      font-size:16px;
      cursor:pointer;
    }
    button:disabled { background:#aaa; }
    .tip {
      font-size:14px;
      color:#666;
      text-align:center;
    }
    canvas { display:block; margin:20px auto; }
  </style>
</head>
<body>

<div class="container">
  <h1>SCL-90 心理健康自评</h1>

  <div class="card" id="intro">
   <p>
如果你最近总是：
<br>• 情绪低落，却说不出原因
<br>• 明明没事，却很累
<br>• 晚上睡不着，白天硬撑
</p>

<p>
这个测试，或许能帮你看清
<strong>你正在承受什么</strong>
</p>

    <p class="tip">匿名 · 今日有效 · 结果只属于你</p>
    <button onclick="startTest()">开始测试</button>
  </div>

  <form id="testForm" class="card" style="display:none"></form>

  <div id="result" class="card" style="display:none"></div>
</div>

<script>
/* ========= 每日链接校验 ========= */
const today = new Date().toISOString().slice(0,10);
const url = new URL(location.href);
if(!url.searchParams.get('token')){
  url.searchParams.set('token', today);
  location.replace(url.toString());
}else if(url.searchParams.get('token') !== today){
  document.body.innerHTML =
    '<div class="container"><div class="card"><h2>链接已失效</h2><p>请获取今日有效测试链接。</p></div></div>';
}

/* ========= SCL-90 题目（示例结构，可补满 90 题）========= */
const questions = [
  {id:1,text:"头痛",factor:"躯体化"},
  {id:2,text:"神经过敏，心中不踏实",factor:"焦虑"},
  {id:3,text:"头脑中有不必要的想法或字句盘旋",factor:"强迫"},
  {id:4,text:"头昏或昏倒",factor:"躯体化"},
  {id:5,text:"对生活中的事情提不起兴趣",factor:"抑郁"},
  // 👉 实际使用时按官方题库补齐到 90 题
];

const scale = ["没有","很轻","中等","偏重","严重"];

/* ========= 开始测试 ========= */
function startTest(){
  document.getElementById("intro").style.display="none";
  const form = document.getElementById("testForm");
  form.style.display="block";

  questions.forEach((q,i)=>{
    const div = document.createElement("div");
    div.className="question";
    div.innerHTML =
      `<p>${i+1}. ${q.text}</p>` +
      scale.map((s,v)=>
        `<label><input type="radio" name="q${i}" value="${v}" required> ${v} ${s}</label>`
      ).join("");
    form.appendChild(div);
  });

  const btn = document.createElement("button");
  btn.type="submit";
  btn.textContent="提交并查看结果";
  form.appendChild(btn);

  form.onsubmit = submitTest;
}

/* ========= 计算结果 ========= */
function submitTest(e){
  e.preventDefault();
  let total = 0;
  let factorMap = {};

  questions.forEach((q,i)=>{
    const v = Number(document.querySelector(`input[name=q${i}]:checked`).value);
    total += v;
    if(!factorMap[q.factor]) factorMap[q.factor]=[];
    factorMap[q.factor].push(v);
  });

  let report = "";
  Object.keys(factorMap).forEach(f=>{
    const avg = (factorMap[f].reduce((a,b)=>a+b,0)/factorMap[f].length).toFixed(2);
    report += `<p>${f}：${avg}</p>`;
  });

  let level = "心理状态基本正常";
  let heal = "你已经做得很好了，允许自己慢一点。";

  const avgTotal = total / questions.length;
  if(avgTotal>=2){
    level="情绪压力偏高";
    heal="你不是脆弱，只是承受得太久了。";
  }

  document.getElementById("testForm").style.display="none";
  const r = document.getElementById("result");
  r.style.display="block";
  r.innerHTML = `
    <h2>你的心理评估结果</h2>
    <p><strong>总分：</strong>${total}</p>
    <p><strong>综合评估：</strong>${level}</p>
    ${report}
    <p style="margin-top:12px;">${heal}</p>
    <p class="tip">结果仅供参考，如持续不适请寻求专业帮助</p>
  `;
}
</script>

</body>
</html>
